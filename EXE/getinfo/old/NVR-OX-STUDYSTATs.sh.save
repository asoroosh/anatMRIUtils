# FUNCTIONS

checkNget () {
## Get a wildcard, check whether it exists and return the number of files under that wildcard

DirExists=1
if ls $1 1> /dev/null 2>&1
then
        ls $1 | wc -l
else
	echo 0
	DirExists=0
fi
}

##########

StudyID=CFTY720D2309

echo ""
echo ""
echo "******** STUDY ID: ${StudyID} ******"

# Make a new directory
DataDir="${HOME}/NVROXBOX/Data"
StudyDir="${DataDir}/${StudyID}"
mkdir -p ${StudyDir}

# Text file for basic stats
BasicStudyInfoTxt=${StudyDir}/${StudyID}_BasicStudyInfoTxt.txt
rm -f $BasicStudyInfoTxt

# Make directory for each image type 
for ImgType in PD T12D T13D T12DCE T22D DWI
do
	echo "Making a directory for: ${StudyDir}/${ImgType}"
	mkdir -p ${StudyDir}/${ImgType}
done

# Text files containing list of image type:
PDImageFileTxt=${StudyDir}/PD/${StudyID}_PD_ImageList.txt
T12DImageFileTxt=${StudyDir}/T12D/${StudyID}_T12D_ImageList.txt
T13DImageFileTxt=${StudyDir}/T13D/${StudyID}_T13D_ImageList.txt
T12DCEImageFileTxt=${StudyDir}/T12DCE/${StudyID}_T12D_ImageList.txt
T22DImageFileTxt=${StudyDir}/T22D/${StudyID}_T22D_ImageList.txt
DWIImageFileTxt=${StudyDir}/DWI/${StudyID}_DWI_ImageList.txt

##### Try for loops ############
PD_Dir="/data/output/habib/unprocessed/${StudyID}.anon.2019.07.15/sub-${StudyID}.*.*/*/anat/sub-*.*.*_ses-V*[0-9]_run-[0-9]_PD.nii.gz"
T12D_Dir="/data/output/habib/unprocessed/${StudyID}.anon.2019.07.15/sub-${StudyID}.*.*/*/anat/sub-*.*.*_ses-V*[0-9]_run-[0-9]_T1w.nii.gz"
T13D_Dir="/data/output/habib/unprocessed/${StudyID}.anon.2019.07.15/sub-${StudyID}.*.*/*/anat/sub-*.*.*_ses-V*[0-9]_acq-3d_run-[0-9]_T1w.nii.gz"
T12DCE_Dir="/data/output/habib/unprocessed/${StudyID}.anon.2019.07.15/sub-${StudyID}.*.*/*/anat/sub-*.*.*_ses-V*[0-9]_ce-Gd_run-[0-9]_T1w.nii.gz"
T22D_Dir="/data/output/habib/unprocessed/${StudyID}.anon.2019.07.15/sub-${StudyID}.*.*/*/anat/sub-*.*.*_ses-V*[0-9]_run-[0-9]_T2w.nii.gz"
DWI_Dir="/data/output/habib/unprocessed/${StudyID}.anon.2019.07.15/sub-${StudyID}.*.*/*/dwi/sub-*.*.*_ses-V*[0-9]_run-[0-9]_dwi.nii.gz"
BVEC_Dir="/data/output/habib/unprocessed/${StudyID}.anon.2019.07.15/sub-${StudyID}.*.*/*/dwi/sub-*.*.*_ses-V*[0-9]_run-[0-9]_dwi.bvec"
BVAL_Dir="/data/output/habib/unprocessed/${StudyID}.anon.2019.07.15/sub-${StudyID}.*.*/*/dwi/sub-*.*.*_ses-V*[0-9]_run-[0-9]_dwi.bval"

for ImgTyp in PD T12D T13D T12DCE T22D DWI BVAL BVEC
do
	eval TMP_Dir='$'${ImgTyp}_Dir
	echo $TMP_Dir
	NUMPD=`checkNget "$TMP_Dir"`
	echo PD2D ${NUMPD} >> $BasicStudyInfoTxt
	ls $TMP_Dir > $ImageFileTxt

        ImageFileTxt=${StudyDir}/${ImgTyp}/${StudyID}_${ImgTyp}_ImageList.txt
        ImageUniqueSubIDs=${StudyDir}/${ImgTyp}/${StudyID}_${ImgTyp}_ImageSubIDs.txt
        rm -f ${ImageUniqueSubIDs}

        while read Tmp_Img_Dir
        do
          	echo $Tmp_Img_Dir | awk -F"/" '{print $7}' >> ${PDImageSubIDs}
        done<$ImageFileTxt

        # Get the unique SubIDs whom has at least one ${ImgTyp} images
        cat ${PDImageSubIDs} | sort -u > $ImageUniqueSubIDs
done

###############################

# Number of subjects:
NUMSUB=`ls /data/output/habib/unprocessed/${StudyID}.anon.2019.07.15 | wc -l`
echo "==Number of Subjects: ${NUMSUB}"
echo SUB ${NUMSUB} >> $BasicStudyInfoTxt

#PD
#PD_Dir="/data/output/habib/unprocessed/${StudyID}.anon.2019.07.15/sub-${StudyID}.*.*/*/anat/sub-*.*.*_ses-V*[0-9]_run-[0-9]_PD.nii.gz"
#NUMPD=`checkNget "$PD_Dir"`
#echo PD2D ${NUMPD} >> $BasicStudyInfoTxt
#ls $PD_Dir > $PDImageFileTxt

#T1w - 2D
#T12D_Dir="/data/output/habib/unprocessed/${StudyID}.anon.2019.07.15/sub-${StudyID}.*.*/*/anat/sub-*.*.*_ses-V*[0-9]_run-[0-9]_T1w.nii.gz"
#NUMT12D=`checkNget "${T12D_Dir}"`
#echo T12D ${NUMT12D} >> $BasicStudyInfoTxt
#ls $T12D_Dir > $T12DImageFileTxt

#T1w - 3D
#T13D_Dir="/data/output/habib/unprocessed/${StudyID}.anon.2019.07.15/sub-${StudyID}.*.*/*/anat/sub-*.*.*_ses-V*[0-9]_acq-3d_run-[0-9]_T1w.nii.gz"
#NUMT13D=`checkNget "${T13D_Dir}"`
#echo T13D ${NUMT13D} >> $BasicStudyInfoTxt
#ls $T13D_Dir > $T13DImageFileTxt

#T1w - 2D - CE Gd
#T12DCE_Dir="/data/output/habib/unprocessed/${StudyID}.anon.2019.07.15/sub-${StudyID}.*.*/*/anat/sub-*.*.*_ses-V*[0-9]_ce-Gd_run-[0-9]_T1w.nii.gz"
#NUMT12DCE=`checkNget "${T12DCE_Dir}"`
#echo CEGd ${NUMT12DCE} >> $BasicStudyInfoTxt
#ls $T12DCE_Dir > $T12DCEImageFileTxt

#T2w
#T22D_Dir="/data/output/habib/unprocessed/${StudyID}.anon.2019.07.15/sub-${StudyID}.*.*/*/anat/sub-*.*.*_ses-V*[0-9]_run-[0-9]_T2w.nii.gz"
#NUMT22D=`checkNget "${T22D_Dir}"`
#echo T22D ${NUMT22D} >> $BasicStudyInfoTxt
#ls $T22D_Dir > $T22DImageFileTxt

#DWI # I should later check the bval and bvec images
#DWI_Dir="/data/output/habib/unprocessed/${StudyID}.anon.2019.07.15/sub-${StudyID}.*.*/*/dwi/sub-*.*.*_ses-V*[0-9]_run-[0-9]_dwi.nii.gz"
#NUMDWI=`checkNget "${DWI_Dir}"`
#echo DWI ${NUMDWI} >> $BasicStudyInfoTxt
#ls $DWI_Dir > $DWIImageFileTxt

#NUMBVEC=`checkNget "/data/output/habib/unprocessed/${StudyID}.anon.2019.07.15/sub-${StudyID}.*.*/*/dwi/sub-*.*.*_ses-V*[0-9]_run-[0-9]_dwi.bvec"`
#NUMBVAL=`checkNget "/data/output/habib/unprocessed/${StudyID}.anon.2019.07.15/sub-${StudyID}.*.*/*/dwi/sub-*.*.*_ses-V*[0-9]_run-[0-9]_dwi.bval"`
#echo "DWI: ${NUMDWI} ( Bvec: ${NUMBVEC} , Bvals: ${NUMBVAL})"

# PD T12D T13D T12DCE T22D DWI


#for ImgTyp in PD T12D T13D T12DCE T22D DWI
#do
#
#	PD_Dir="/data/output/habib/unprocessed/${StudyID}.anon.2019.07.15/sub-${StudyID}.*.*/*/anat/sub-*.*.*_ses-V*[0-9]_run-[0-9]_PD.nii.gz"
#	NUMPD=`checkNget "$PD_Dir"`
#	echo PD2D ${NUMPD} >> $BasicStudyInfoTxt
#	ls $PD_Dir > $PDImageFileTxt
#
#	ImageFileTxt=${StudyDir}/${ImgTyp}/${StudyID}_${ImgTyp}_ImageList.txt
#	ImageUniqueSubIDs=${StudyDir}/${ImgTyp}/${StudyID}_${ImgTyp}_ImageSubIDs.txt
#	rm -f ${ImageUniqueSubIDs}
#
#	while read Tmp_Img_Dir
#	do
# 		echo $Tmp_Img_Dir | awk -F"/" '{print $7}' >> ${PDImageSubIDs}
#	done<$ImageFileTxt
#
#	# Get the unique SubIDs whom has at least one ${ImgTyp} images
#	cat ${PDImageSubIDs} | sort -u > $ImageUniqueSubIDs
#done

# Find Subject ID of all PD images ######################################
#PDImageSubIDs=${StudyDir}/PD/PDImageSubIDs.txt
#rm -f $PDImageSubIDs
#while read Tmp_Img_Dir
#do
#	echo $Tmp_Img_Dir | awk -F"/" '{print $7}' >> ${PDImageSubIDs}
#done<$PDImageFileTxt

# Get the unique SubIDs whom has the PD images 
#cat ${PDImageSubIDs} | sort -u > PDImageSubIDs

# Find Subject ID of all T12D images #####################################
#PDImageSubIDs=${StudyDir}/T12D/T12DImageSubIDs.txt
#rm -f $PDImageSubIDs
#while read Tmp_Img_Dir
#do
#  	echo $Tmp_Img_Dir | awk -F"/" '{print $7}' >> ${T12DImageSubIDs}
#done<$T12DImageFileTxt

# Get the unique SubIDs whom has the T12D images 
#cat ${T12DImageSubIDs} | sort -u > T12DImageSubIDs

# Find Subject ID of all T13D images ####################################
#T13DImageSubIDs=${StudyDir}/T13D/T13DImageSubIDs.txt
#rm -f $T13DImageSubIDs
#while read Tmp_Img_Dir
#do
#  	echo $Tmp_Img_Dir | awk -F"/" '{print $7}' >> ${T13DImageSubIDs}
#done<$T13DImageFileTxt

# Get the unique SubIDs whom has the T13D images
#cat ${T13DImageSubIDs} | sort -u > $T13DImageSubIDs


# Find Subject ID of all T12DCE images ###################################
#T12DCEImageSubIDs=${StudyDir}/T12DCE/T12DCEImageSubIDs.txt
#rm -f $T12DCEImageSubIDs
#while read Tmp_Img_Dir
#do
#  	echo $Tmp_Img_Dir | awk -F"/" '{print $7}' >> ${PDImageSubIDs}
#done<$T12DCEImageFileTxt

# Get the unique SubIDs whom has the T12DCE images
#cat ${T12DCEImageSubIDs} | sort -u > $T12DCEImageSubIDs


# Find Subject ID of all T22D images ##################################
#T22DImageSubIDs=${StudyDir}/T22D/T22DImageSubIDs.txt
#rm -f $T22DImageSubIDs
#while read Tmp_Img_Dir
#do
#  	echo $Tmp_Img_Dir | awk -F"/" '{print $7}' >> ${T22DImageSubIDs}
#done<$T22DImageFileTxt

# Get the unique SubIDs whom has the T22D images
#cat ${T22DImageSubIDs} | sort -u > $T22DImageSubIDs

# Find Subject ID of all DWI images ##################################
#DWIImageSubIDs=${StudyDir}/DWI/DWIImageSubIDs.txt
#rm -f $DWIImageSubIDs
#while read Tmp_Img_Dir
#do
#  	echo $Tmp_Img_Dir | awk -F"/" '{print $7}' >> ${DWIImageSubIDs}
#done<$DWIImageFileTxt

# Get the unique SubIDs whom has the DWI images
#cat ${DWIImageSubIDs} | sort -u > $DWIImageSubIDs



# Parse SubjectIDs of specific image type?
# to parse the file path 
# SubID=$(echo $DirName | awk -F"/" '{print $7}')
# SesID=$(echo $DirName | awk -F"/" '{print $8}')
# TypeID=$(echo $DirName | awk -F"/" '{print $9}')
# ImageName=$(echo $DirName | awk -F"/" '{print $10}')
